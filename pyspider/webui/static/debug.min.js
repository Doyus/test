(()=>{var e={542:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var n,r="object"===("undefined"==typeof Reflect?"undefined":t(Reflect))?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}m(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,n)}(e,o,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+t(e))}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var o,i,s,a;if(l(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=c(e))>0&&s.length>o&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,a=u,console&&console.warn&&console.warn(a)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=d.bind(r);return o.listener=n,r.wrapFn=o,o}function p(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):v(o,o.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,n,r,o){if("function"==typeof e.on)o.once?e.once(n,r):e.on(n,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+t(e));e.addEventListener(n,(function t(i){o.once&&e.removeEventListener(n,t),r(i)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var c=l.length,u=v(l,c);for(n=0;n<c;++n)o(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return l(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,o,i,s;if(l(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},117:()=>{$.fn.splitter=function(e){var t=$(document),n=$('<div class="block"></div>'),r=$("body"),o=JSON.parse(localStorage.getItem("splitterSettings")||"[]");return this.each((function(){var i=$(this),s=$(this),a=$.fn.splitter.guid++,l=i.parent(),c=e||"x",u="x"===c?i.prevAll(":visible:first"):i.nextAll(":visible:first"),d=$('<div class="resize"></div>'),f=!1,p=(l.width(),l.offset()),h=(p.left,p.top),v={x:{display:"block",currentPos:l.offset().left,multiplier:1,cssProp:"left",otherCssProp:"right",size:l.width(),sizeProp:"width",moveProp:"pageX",init:{top:0,bottom:0,width:8,"margin-left":"-4px",height:"100%",left:"auto",right:"auto",opacity:0,position:"absolute",cursor:"ew-resize","border-left":"1px solid rgba(218, 218, 218, 0.5)","z-index":99999}},y:{display:"block",currentPos:l.offset().top,multiplier:-1,size:l.height(),cssProp:"bottom",otherCssProp:"top",sizeProp:"height",moveProp:"pageY",init:{top:"auto",cursor:"ns-resize",bottom:"auto",height:8,width:"100%",left:0,right:0,opacity:0,position:"absolute",border:0,"z-index":99999}}},m=o[a]||{},g={down:{x:null,y:null},delta:{x:null,y:null},track:!1,timer:null};function y(e){"y"===c&&(e-=h);var n=e-v[c].currentPos,r=100/v[c].size*n,s=(e-m[c])*v[c].multiplier,l=u[v[c].sizeProp](),f=i[v[c].sizeProp]();if("y"===c&&(r=100-r),l<100&&s<0);else if(f<100&&s>0);else{i.css(v[c].cssProp,r+"%"),u.css(v[c].otherCssProp,100-r+"%");var p={};p[v[c].cssProp]=r+"%",d.css(p),m[c]=e,o[a]=m,localStorage.setItem("splitterSettings",JSON.stringify(o)),y.timer&&clearTimeout(y.timer),y.timer=setTimeout((function(){t.trigger("sizeeditors")}),120)}}function b(){u="x"===c?d.prevAll(":visible:first"):d.nextAll(":visible:first")}d.bind("mousedown",(function(e){g.down.x=e.pageX,g.down.y=e.pageY,g.delta={x:null,y:null},g.target=.25*d["x"==c?"height":"width"]()})),t.bind("mousemove",(function(e){f&&(g.delta.x=g.down.x-e.pageX,g.delta.y=g.down.y-e.pageY,clearTimeout(g.timer),g.timer=setTimeout((function(){g.down.x=e.pageX,g.down.y=e.pageY}),250))})),t.bind("mouseup touchend",(function(){f&&(f=!1,d.trigger("resize-end"),n.remove(),r.removeClass("dragging"))})).bind("mousemove touchmove",(function(e){f&&y(e[v[c].moveProp]||e.originalEvent.touches[0][v[c].moveProp])})),n.bind("mousemove touchmove",(function(e){f&&y(e[v[c].moveProp]||e.originalEvent.touches[0][v[c].moveProp])})),d.bind("mousedown touchstart",(function(e){f=!0,d.trigger("resize-start"),r.append(n).addClass("dragging"),v[c].size=l[v[c].sizeProp](),v[c].currentPos=0,b(),e.preventDefault()})),d.bind("fullsize",(function(e,t){void 0===t&&(t="prev");var n=0;"prev"===t&&(n=100),i.css(v[c].cssProp,n+"%"),u.css(v[c].otherCssProp,100-n+"%"),d.hide()})),d.bind("init",(function(e,t){d.css(v[c].init),v[c].size=l[v[c].sizeProp](),b(),h=l.offset().top,n.css("cursor","x"==c?"ew-resize":"ns-resize"),"y"==c?(i.css("border-right",0),u.css("border-left",0),u.css("border-top","2px solid #ccc")):i.css("border-top",0),i.is(":hidden")?d.hide():(u.length?i.css("border-"+v[c].cssProp,"1px solid #ccc"):i.css("border-"+v[c].cssProp,"0"),y(void 0!==t?t:m[c]||i.offset()[v[c].cssProp]))})),d.bind("change",(function(e,t,n){i.css(v[c].cssProp,"0"),u.css(v[c].otherCssProp,"0"),i.css("border-"+v[c].cssProp,"0"),"y"===t?(i=i.find("> *"),d.appendTo(u),i.appendTo(u),u.css("height","100%"),s.hide(),d.css("margin-left",0),d.css("margin-top",5),d.addClass("vertical"),delete m.x,s.nextAll(":visible:first").trigger("init")):(i=u,u=r,i.appendTo(s),d.insertBefore(s),d.removeClass("vertical"),i.css("border-top",0),i=s,s.show(),d.css("margin-top",0),d.css("margin-left",-4),delete m.y,setTimeout((function(){s.nextAll(":visible:first").trigger("init")}),0)),b(),c=t;var r=i;if(i=u,u=r,i.css(v[c].otherCssProp,"0"),u.css(v[c].cssProp,"0"),i.is(":visible")){if("y"===c){var o=i.find(".resize");o.each((function(e){var t=$(this);this===d[0]||t.trigger("init",100/(o-e-1))}))}d.trigger("init",n||i.offset()[v[c].cssProp]||v[c].size/2)}})),u.css("width","auto"),u.css("height","auto"),i.data("splitter",d),i.before(d)}))},$.fn.splitter.guid=0}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";n(117);var e=n(542);function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}function a(e,n,r){return n=c(n),function(e,n){if(n&&("object"==t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,l()?Reflect.construct(n,r||[],c(e).constructor):n.apply(e,r))}function l(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(l=function(){return!!e})()}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function d(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function f(e){var t=0,n=0;do{isNaN(e.offsetLeft)||(n+=e.offsetLeft),isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return{top:t,left:n}}function p(e){var t="";return e.forEach((function(e){e.selected&&(t+=e.name)})),t}function h(e,t){var n="",r=null;return e.forEach((function(e,o){if(!(t>=0&&o>t))if(e.invalid)r=null;else if(e.selected){r&&(n+=" >");var i="";e.features.forEach((function(e){e.selected&&(i+=e.pattern)})),""===i&&(i="*"),n+=" "+i,r=e}else r=null})),""===n&&(n="*"),n}var v=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=a(this,t)).window=e,n.document=e.document,n.document.addEventListener("mouseover",(function(e){n.overlay(e.target)})),n.document.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),n.emit("selector_helper_click",function(e,t){var n=[];do{var r=[];if(r.push({name:t.tagName.toLowerCase(),pattern:t.tagName.toLowerCase(),selected:!0}),t.getAttribute("id")&&r.push({name:"#"+t.getAttribute("id"),pattern:"#"+t.getAttribute("id"),selected:!0}),t.classList.length>0)for(var o=0;o<t.classList.length;o++){var i=t.classList[o];r.push({name:"."+i,pattern:"."+i,selected:!0})}for(var s="itemprop",a=(o=0,t.attributes);o<a.length;o++)-1!=s.indexOf(a[o].nodeName)&&r.push({name:"["+a[o].nodeName+"="+JSON.stringify(a[o].nodeValue)+"]",pattern:"["+a[o].nodeName+"="+JSON.stringify(a[o].nodeValue)+"]",selected:!0});for(var l=t.parentNode.childNodes,c=t.tagName.toLowerCase(),u=(o=0,0);l.length>1&&o<l.length;o++){var f=l[o];if(f===t){c+="["+(u+1)+"]";break}f.tagName==t.tagName&&u++}n.push({tag:t.tagName.toLowerCase(),name:p(r),xpath:c,selected:!0,invalid:"tbody"===t.tagName.toLowerCase(),features:r})}while(t=t.parentElement);n.reverse();var v=e.querySelectorAll(h(n));return n.forEach((function(t,r){if(!t.invalid){var o=e.querySelectorAll(h(n,r));t.features.forEach((function(t,i){t.selected=!1,d(o,e.querySelectorAll(h(n,r)))||(t.selected=!0)})),t.features.every((function(e){return!e.selected}))&&(t.features[0].selected=!0),t.name=p(t.features)}})),n.forEach((function(t,r){t.selected=!1,d(v,e.querySelectorAll(h(n)))?t.name=t.tag:t.selected=!0})),n}(n.document,e.target))})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,e),n=t,(o=[{key:"overlay",value:function(e){var t=this;"string"==typeof e&&(e=this.document.querySelectorAll(e)),e instanceof this.window.Element&&(e=[e]),r(this.document.querySelectorAll(".pyspider_overlay")).forEach((function(e){e.remove()})),r(e).forEach((function(e){var n=f(e),r=t.document.createElement("div");r.className="pyspider_overlay",r.setAttribute("style","z-index: 999999;background-color: rgba(255, 165, 0, 0.3);position: absolute;pointer-events: none;top: "+n.top+"px;left:"+n.left+"px;width: "+e.offsetWidth+"px;height: "+e.offsetHeight+"px;"),t.document.body.appendChild(r)}))}},{key:"heightlight",value:function(e){var t=this;"string"==typeof e&&(e=this.document.querySelectorAll(e)),console.log(e),e instanceof this.window.Element&&(e=[e]),r(this.document.querySelectorAll(".pyspider_highlight")).forEach((function(e){e.remove()})),r(e).forEach((function(e){var n=f(e),r=t.document.createElement("div");r.className="pyspider_highlight",r.setAttribute("style","z-index: 888888;border: 2px solid #c00;position: absolute;pointer-events: none;top: "+(n.top-2)+"px;left:"+(n.left-2)+"px;width: "+e.offsetWidth+"px;height: "+e.offsetHeight+"px;"),t.document.body.appendChild(r)}))}},{key:"getElementByXpath",value:function(e){return this.document.evaluate(e,this.document,null,this.window.XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}])&&i(n.prototype,o),s&&i(n,s),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,s}(n.n(e)());window.SelectorHelper=function(){var e=$("#css-selector-helper"),t=null;function n(e){var t=e.features,n="";return t.forEach((function(e){e.selected&&(n+=e.name)})),""===n?e.tag:n}function r(e,t){var n="",r=null;return e.forEach((function(e,o){if(!(t>=0&&o>t))if(e.invalid)r=null;else if(e.selected){r&&(n+=" >");var i="";e.features.forEach((function(e){e.selected&&(i+=e.pattern)})),""===i&&(i="*"),n+=" "+i,r=e}else r=null})),""===n&&(n="*"),n.trim()}var o=null;function i(e){o=e,t.heightlight(r(e))}function s(r){e.find(".element").remove();var o=[];$.each(r,(function(e,s){var a=$("<span>").addClass("element").data("info",s);$('<span class="element-name">').text(s.name).appendTo(a),s.selected&&a.addClass("selected"),s.invalid&&a.addClass("invalid");var l=$("<ul>");$.each(s.features,(function(e,t){var o=$("<li>").text(t.name).data("feature",t);t.selected&&o.addClass("selected"),o.appendTo(l),o.on("click",(function(e){e.stopPropagation();var t=$(this),o=t.data("feature");o.selected?(o.selected=!1,t.removeClass("selected")):(o.selected=!0,t.addClass("selected"));var a=t.parents(".element");s.selected||(s.selected=!0,a.addClass("selected")),a.find(".element-name").text(n(s)),i(r)}))})),l.appendTo(a),a.on("mouseover",(function(e){var n=[];$.each(r,(function(e,t){if(n.push(t.xpath),t===s)return!1})),t.overlay(t.getElementByXpath("/"+n.join("/")))})),a.on("click",(function(e){e.stopPropagation();var t=$(this),o=t.data("info");o.selected?(o.selected=!1,t.removeClass("selected")):(o.selected=!0,t.addClass("selected")),t.find(".element-name").text(n(t.data("info"))),i(r)})),o.push(a)})),e.prepend(o),function(){for(;e[0].scrollWidth>e.width();){var t=e.find(".element:visible:first");if(0==t.length)return;t.addClass("invalid").data("info").invalid=!0}}(),i(r)}var a=$("#tab-web");return{init:function(){var n=this;this.clear(),$("#J-enable-css-selector-helper").on("click",(function(e){n.clear(),(t=new v($("#tab-web iframe")[0].contentWindow)).on("selector_helper_click",(function(e){s(e)})),n.enable()})),$("#task-panel").on("scroll",(function(t){e.is(":visible")&&($("#debug-tabs").position().top<0?(e.addClass("fixed"),a.addClass("fixed")):(e.removeClass("fixed"),a.removeClass("fixed")))}));var i=e.find(".copy-selector-input");i.on("focus",(function(e){$(this).select()})),e.find(".copy-selector").on("click",(function(t){o&&(i.is(":visible")?(i.hide(),e.find(".element").show()):(e.find(".element").hide(),i.val(r(o)).show()))})),e.find(".add-to-editor").on("click",(function(e){Debugger.python_editor_replace_selection(r(o))}))},clear:function(){o=null,e.hide(),e.removeClass("fixed"),a.removeClass("fixed"),e.find(".element").remove()},enable:function(){e.show(),e.find(".copy-selector-input").hide(),$("#debug-tabs").position().top<0?(e.addClass("fixed"),a.addClass("fixed")):(e.removeClass("fixed"),a.removeClass("fixed"))}}}(),window.Debugger=function(){console.log("aaaaa","aaa");var e=$("<div>");function t(t){return e.text(t).html()}return{init:function(){this.splitter=$(".debug-panel:not(:first)").splitter().data("splitter").trigger("init").on("resize-start",(function(){$("#left-area .overlay").show()})).on("resize-end",(function(){$("#left-area .overlay").hide()})),CodeMirror.keyMap.basic.Tab="indentMore",this.init_python_editor($("#python-editor")),this.init_task_editor($("#task-editor")),this.bind_debug_tabs(),this.bind_run(),this.bind_save(),this.bind_others(),SelectorHelper.init()},not_saved:!1,init_python_editor:function(e){var t=this;this.python_editor_elem=e;var n=this.python_editor=CodeMirror(e[0],{value:script_content,mode:"python",lineNumbers:!0,indentUnit:4,lineWrapping:!0,styleActiveLine:!0,autofocus:!0});n.on("focus",(function(){e.addClass("focus")})),n.on("blur",(function(){e.removeClass("focus")})),n.on("change",(function(){t.not_saved=!0})),window.addEventListener("beforeunload",(function(e){if(t.not_saved){var n="You have not saved changes.";return(e||window.event).returnValue=n,n}}))},python_editor_replace_selection:function(e){this.python_editor.getDoc().replaceSelection(e)},auto_format:function(e){var t=e.getCursor(!0);CodeMirror.commands.selectAll(e),e.autoFormatRange(e.getCursor(!0),e.getCursor(!1)),e.setCursor(t)},format_string:function(e,t){var n=document.createElement("div"),r=CodeMirror(n,{value:e,mode:t});return this.auto_format(r),r.getDoc().getValue()},init_task_editor:function(e){var t=this.task_editor=CodeMirror(e[0],{value:task_content,mode:"application/json",indentUnit:2,lineWrapping:!0,styleActiveLine:!0,lint:!0});this.auto_format(t),t.getDoc().clearHistory(),t.on("focus",(function(){e.addClass("focus")})),t.on("blur",(function(){e.removeClass("focus")}))},bind_debug_tabs:function(){var e=this;$("#tab-control > li[data-id]").on("click",(function(){$("#tab-control > li[data-id]").removeClass("active");var e=$(this).addClass("active").data("id");$("#debug-tabs .tab").hide(),$("#debug-tabs #"+e).show()})),$("#tab-control li[data-id=tab-html]").on("click",(function(){if(!$("#tab-html").data("format")){var n="";CodeMirror.runMode(e.format_string($("#tab-html pre").text(),"text/html"),"text/html",(function(e,r){n+=r?'<span class="cm-'+r+'">'+t(e)+"</span>":t(e)})),$("#tab-html pre").html(n),$("#tab-html").data("format",!0)}}))},bind_run:function(){var e=this;$("#run-task-btn").on("click",(function(){e.run()})),$("#undo-btn").on("click",(function(t){e.task_editor.execCommand("undo")})),$("#redo-btn").on("click",(function(t){e.task_editor.execCommand("redo")}))},bind_save:function(){var e=this;$("#save-task-btn").on("click",(function(){var t=e.python_editor.getDoc().getValue();$("#right-area .overlay").show(),$.ajax({type:"POST",url:location.pathname+"/save",data:{script:t},success:function(t){console.log(t),e.python_log(""),e.python_log("saved!"),e.not_saved=!1,$("#right-area .overlay").hide()},error:function(t,n,r){console.log(t,n,r),e.python_log("save error!\n"+t.responseText),$("#right-area .overlay").hide()}})}))},bind_follows:function(){var e=this;$(".newtask").on("click",(function(){if($(this).next().hasClass("task-show"))$(this).next().remove();else{var e=$(this).after('<div class="task-show"><pre class="cm-s-default"></pre></div>').data("task");e=JSON.stringify(window.newtasks[e],null,"  "),CodeMirror.runMode(e,"application/json",$(this).next().find("pre")[0])}})),$(".newtask .task-run").on("click",(function(t){t.preventDefault(),t.stopPropagation();var n=$(this).parents(".newtask").data("task"),r=window.newtasks[n];e.task_editor.setValue(JSON.stringify(r,null,"  ")),e.task_updated(r),e.run()}))},task_updated:function(e){$("#history-wrap").hide(),e.project&&e.taskid&&$.ajax({url:"/pyspider/task/".concat(e.project,":").concat(e.taskid,".json"),success:function(t){t.code||t.error||($("#history-link").attr("href","/task/".concat(e.project,":").concat(e.taskid)).text("status: ".concat(t.status_string)),$("#history-wrap").show())}})},bind_others:function(){var e=this;$("#python-log-show").on("click",(function(){$("#python-log pre").is(":visible")?($("#python-log pre").hide(),$(this).height(8)):($("#python-log pre").show(),$(this).height(0))})),$(".webdav-btn").on("click",(function(){e.toggle_webdav_mode(this)}))},render_html:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];void 0===e&&(e="");var o=(new DOMParser).parseFromString(e,"text/html");return $(o).find("base").remove(),$(o).find("head").prepend("<base>"),$(o).find("base").attr("href",t),n&&$(o).find("script").attr("type","text/plain"),r&&$(o).find("iframe[src]").each((function(e,t){(t=$(t)).attr("__src",t.attr("src")),t.attr("src",encodeURI("data:text/html;,<h1>iframe blocked</h1>"))})),o.documentElement.innerHTML},run:function(){var e=this.python_editor.getDoc().getValue(),t=this.task_editor.getDoc().getValue(),n=this;SelectorHelper.clear(),$("#tab-web .iframe-box").html(""),$("#tab-html pre").html(""),$("#tab-follows").html(""),$("#tab-control li[data-id=tab-follows] .num").hide(),$("#python-log").hide(),$("#left-area .overlay").show(),$.ajax({type:"POST",url:location.pathname+"/pyspider/run",data:{webdav_mode:n.webdav_mode,script:n.webdav_mode?"":e,task:t},success:function(e){console.log(e),$("#left-area .overlay").hide(),$("#tab-web .iframe-box").html('<iframe src="/blank.html" sandbox="allow-same-origin allow-scripts" height="50%"></iframe>');var t=$("#tab-web iframe")[0],r=e.fetch_result.headers&&e.fetch_result.headers["Content-Type"]&&e.fetch_result.headers["Content-Type"]||"text/plain";$("#tab-html pre").text(e.fetch_result.content),$("#tab-html").data("format",!0);var o=null;if(0==r.indexOf("application/json"))try{var i=JSON.parse(e.fetch_result.content);i="<html><pre>"+(i=JSON.stringify(i,null,"  "))+"</pre></html>",o=n.render_html(i,e.fetch_result.url,!0,!0,!1)}catch(e){o="data:,Content-Type:"+r+" parse error."}else 0==r.indexOf("text/html")?($("#tab-html").data("format",!1),o=n.render_html(e.fetch_result.content,e.fetch_result.url,!0,!0,!1)):o=0==r.indexOf("text")?"data:"+r+","+e.fetch_result.content:e.fetch_result.dataurl?e.fetch_result.dataurl:"data:,Content-Type:"+r;var s=t.contentDocument;s.open("text/html","replace"),s.write(o),s.close(),s.onreadystatechange=function(){if("complete"===s.readyState){var e=0===s.body.scrollHeight?1e3:s.body.scrollHeight+60;$("#tab-messages iframe").height(e)}},$("#tab-follows").html("");var a=$("#tab-control li[data-id=tab-follows] .num");if(e.follows.length>0){a.text(e.follows.length).show();var l="";window.newtasks={},$.each(e.follows,(function(e,t){var n=t.process;n=n&&n.callback||"__call__";var r='<div class="newtask" data-task="__task__"><span class="task-callback">__callback__</span> &gt; <span class="task-url">__url__</span><div class="task-run"><i class="fa fa-play"></i></div><div class="task-more"> <i class="fa fa-ellipsis-h"></i> </div></div>'.replace("__callback__",n);r=r.replace("__url__",t.url||'<span class="error">no_url!</span>'),l+=r.replace("__task__",e),window.newtasks[e]=t})),$("#tab-follows").append(l),n.bind_follows()}else a.hide();if($("#tab-messages pre").html(""),e.messages.length>0){$("#tab-control li[data-id=tab-messages] .num").text(e.messages.length).show();var c=function(e){var t="",n="";for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];"description"===r?n=o:t+="<div>"+r+": &nbsp;&nbsp;&nbsp;"+o+"</div>"}return""!==n&&(t+='正文内容：<div style="border: 1px solid #ccc; padding: 10px;">'+n+"</div>"),t}(e.messages[0][1]);console.log("dypsss",c),$("#tab-messages .iframe-box").html('<iframe sandbox="allow-same-origin allow-scripts" height="50%"></iframe>');var u=$("#tab-messages iframe")[0];$(u).css({width:"100%",border:"none"});var d=u.contentDocument;d.open("text/html","replace"),d.write(c),d.close(),d.onreadystatechange=function(){if("complete"===d.readyState){var e=0===d.body.scrollHeight?1e3:d.body.scrollHeight+60;$("#tab-messages iframe").height(e)}},$(u).on("load",(function(){var e=0===d.body.scrollHeight?1e3:d.body.scrollHeight+60;$(u).height(e)}))}else $("#tab-control li[data-id=tab-messages] .num").hide();$("#tab-control li.active").click(),n.python_log(e.logs)},error:function(e,t,r){console.log(e,t,r),n.python_log("error: "+t),$("#left-area .overlay").hide()}})},python_log:function(e){e?($("#python-log pre").text(e),$("#python-log pre, #python-log").show(),$("#python-log-show").height(0)):$("#python-log pre, #python-log").hide()},webdav_mode:!1,toggle_webdav_mode:function(e){if(this.webdav_mode){var t=this;$.ajax({type:"GET",url:location.pathname+"/get",success:function(n){t.splitter.trigger("init"),t.python_editor_elem.show(),t.python_editor.setValue(n.script),t.not_saved=!1,$(e).removeClass("active"),t.webdav_mode=!t.webdav_mode},error:function(){alert("Loading script from database error. Script may out-of-date."),t.python_editor_elem.show(),t.splitter.trigger("init"),$(e).removeClass("active"),t.webdav_mode=!t.webdav_mode}})}else{if(this.not_saved){if(!confirm("You have not saved changes. Ignore changes and switch to WebDav mode."))return;this.not_saved=!1}this.python_editor_elem.hide(),this.splitter.trigger("fullsize","prev"),$(e).addClass("active"),this.webdav_mode=!this.webdav_mode}}}}(),Debugger.init()})()})();